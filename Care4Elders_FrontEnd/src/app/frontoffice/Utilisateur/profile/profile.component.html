

<div class="container">
  <div class="row gutters">

    <!-- Colonne Avatar -->
    <div class="col-xl-3 col-lg-3 col-md-12 col-sm-12 col-12">
      <div class="card h-100">
        <div class="card-body">
          <div class="account-settings">
            <div class="user-profile text-center">
              <label for="fileInput">
                <img [src]="avatarPreview || 'https://bootdey.com/img/Content/avatar/avatar7.png'" alt="Avatar utilisateur" class="rounded-circle" style="cursor: pointer; width: 150px; height: 150px; object-fit: cover;">
              </label>
              <input type="file" id="fileInput" (change)="onFileSelected($event)" hidden accept="image/*">
              <h5 class="user-name mt-3">{{ profilForm.get('username')?.value }}</h5>
              <h6 class="user-email">{{ profilForm.get('email')?.value }}</h6>
            </div>
            <div class="about">
              <h5>À propos</h5>
              <p>Informations personnelles de l'utilisateur.</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Colonne Formulaire -->
    <div class="col-xl-9 col-lg-9 col-md-12 col-sm-12 col-12">
      <div class="card h-100">
        <div class="card-body">
          <form *ngIf="profilForm" [formGroup]="profilForm" (ngSubmit)="onSubmit()">
            <div class="row gutters">
              <div class="col-12">
                <h6 class="mb-2 text-primary">Détails personnels</h6>
              </div>

              <!-- Champs généraux -->
              <div class="col-md-6" *ngFor="let field of ['username', 'email', 'phoneNumber', 'dateOfBirth', 'password', 'role']">
                <div class="form-group">
                  <label>{{ field === 'username' ? "Nom d'utilisateur" : field === 'phoneNumber' ? "Numéro de téléphone" : field === 'dateOfBirth' ? "Date de naissance" : field === 'password' ? "Mot de passe" : field === 'role' ? "Rôle" : "Email" }}</label>
                  <input [type]="field === 'email' ? 'email' : field === 'password' ? 'password' : field === 'dateOfBirth' ? 'date' : 'text'" 
                         class="form-control" formControlName="{{ field }}" [readonly]="field === 'password' || field === 'role'">
                </div>
              </div>
            </div>

            <!-- Sections spécifiques -->
            <div *ngIf="role === 'PATIENT'" class="mt-4">
              <h6 class="mb-2 text-primary">Informations Patient</h6>
              <div class="form-group">
                <label>Adresse</label>
                <input type="text" class="form-control" formControlName="adressePatient">
              </div>
              <div class="form-group">
                <label>Dossier Médical (PDF)</label>
                <div *ngIf="previewUrls['dossierMedicalPdf']">
                  <a [href]="previewUrls['dossierMedicalPdf']" target="_blank">Voir le dossier</a>
                </div>
                <input type="file" (change)="onFileSelected($event, 'dossierMedicalPdf')" accept="application/pdf">
              </div>
            </div>

            <div *ngIf="role === 'MEDECIN'" class="mt-4">
              <h6 class="mb-2 text-primary">Informations Médecin</h6>
              <div class="form-group">
                <label>Spécialité</label>
                <input type="text" class="form-control" formControlName="specialite">
              </div>
              <div class="form-group">
                <label>Numéro d'ordre</label>
                <input type="text" class="form-control" formControlName="numeroOrdre">
              </div>
              <div class="form-group">
                <label>Diplôme (PDF)</label>
                <div *ngIf="previewUrls['fichierDiplome']">
                  <a [href]="previewUrls['fichierDiplome']" target="_blank">Voir le diplôme</a>
                </div>
                <input type="file" (change)="onFileSelected($event, 'fichierDiplome')" accept="application/pdf">
              </div>
            </div>

            <div *ngIf="role === 'AIDANT'" class="mt-4">
              <h6 class="mb-2 text-primary">Informations Aidant</h6>
              <div class="form-group">
                <label>Adresse</label>
                <input type="text" class="form-control" formControlName="adresseAidant">
              </div>
              <div class="form-group">
                <label>Carte d'identité (PDF)</label>
                <div *ngIf="previewUrls['cartedIentite']">
                  <a [href]="previewUrls['cartedIentite']" target="_blank">Voir la carte</a>
                </div>
                <input type="file" (change)="onFileSelected($event, 'cartedIentite')" accept="application/pdf">
              </div>
            </div>

            <!-- Spinner -->
            <div *ngIf="isLoading" class="text-center my-3">
              <div class="spinner-border text-primary" role="status"></div>
            </div>

            <!-- Boutons -->
            <div class="row gutters mt-4">
              <div class="col-12 text-end">
                <button type="button" class="btn btn-secondary me-2" (click)="onCancel()">Annuler</button>
                <button type="submit" class="btn btn-primary">Mettre à jour</button>
                <button (click)="supprimerCompte()" class="btn-danger">
  Supprimer le compte
</button>
              </div>
            </div>

          </form>
        </div>
      </div>
    </div>

  </div>
</div>
